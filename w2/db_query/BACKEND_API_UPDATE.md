# åç«¯ API æ›´æ–°æ€»ç»“

æ ¹æ® `instructions.md` çš„è¦æ±‚ï¼Œå·²æ·»åŠ ä»¥ä¸‹åç«¯æ¥å£ï¼š

## âœ… æ–°å¢åç«¯æ¥å£

### 1. åˆ é™¤æ•°æ®åº“è¿æ¥æ¥å£
**ç«¯ç‚¹**: `DELETE /api/v1/dbs/{name}`

**åŠŸèƒ½**:
- åˆ é™¤æŒ‡å®šçš„æ•°æ®åº“è¿æ¥
- åŒæ—¶åˆ é™¤å…³è”çš„å…ƒæ•°æ®
- è¿”å› 204 No Content

**å®ç°ä½ç½®**: `backend/app/routes/databases.py` çš„ `delete_db` å‡½æ•°

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
await apiClient.deleteDatabase('postgres')
```

### 2. æŒ‰éœ€åŠ è½½è¡¨åˆ—è¡¨æ¥å£
**ç«¯ç‚¹**: `GET /api/v1/dbs/{name}/tables?schema={schema}`

**åŠŸèƒ½**:
- ç›´æ¥ä»æ•°æ®åº“è·å–è¡¨åˆ—è¡¨ï¼ˆä¸ä¾èµ–ç¼“å­˜çš„å…ƒæ•°æ®ï¼‰
- æ”¯æŒæŒ‰æ¨¡å¼ï¼ˆschemaï¼‰ç­›é€‰
- è¿”å›æŒ‰æ¨¡å¼åˆ†ç»„çš„è¡¨åˆ—è¡¨

**å“åº”æ ¼å¼**:
```json
{
  "schemas": [
    {
      "name": "public",
      "tables": [
        {
          "name": "users",
          "type": "table",
          "schema": "public"
        }
      ]
    }
  ]
}
```

**å®ç°ä½ç½®**: `backend/app/routes/databases.py` çš„ `get_db_tables` å‡½æ•°

### 3. æŒ‰éœ€åŠ è½½è¡¨åˆ—ä¿¡æ¯æ¥å£
**ç«¯ç‚¹**: `GET /api/v1/dbs/{name}/tables/{schema}/{table}/columns`

**åŠŸèƒ½**:
- ç›´æ¥ä»æ•°æ®åº“è·å–æŒ‡å®šè¡¨çš„åˆ—ä¿¡æ¯
- è¿”å›åˆ—çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåç§°ã€ç±»å‹ã€æ˜¯å¦å¯ç©ºã€é»˜è®¤å€¼ã€ä½ç½®ï¼‰

**å“åº”æ ¼å¼**:
```json
{
  "schema": "public",
  "table": "users",
  "columns": [
    {
      "name": "id",
      "type": "integer",
      "nullable": false,
      "default": null,
      "position": 1
    }
  ]
}
```

**å®ç°ä½ç½®**: `backend/app/routes/databases.py` çš„ `get_table_columns` å‡½æ•°

## ğŸ”„ å‰ç«¯æ›´æ–°

### API å®¢æˆ·ç«¯ (`api/client.ts`)
- âœ… æ·»åŠ  `deleteDatabase` æ–¹æ³•
- âœ… æ·»åŠ  `getDatabaseTables` æ–¹æ³•
- âœ… æ·»åŠ  `getTableColumns` æ–¹æ³•

### æ•°æ®åº“æ ‘ç»„ä»¶ (`DatabaseTree.tsx`)
- âœ… ä½¿ç”¨æ–°çš„æŒ‰éœ€åŠ è½½æ¥å£æ›¿ä»£æ—§çš„å…ƒæ•°æ®ç¼“å­˜æ–¹å¼
- âœ… ç‚¹å‡»æ•°æ®åº“å›¾æ ‡æ—¶è°ƒç”¨ `getDatabaseTables` åŠ è½½è¡¨åˆ—è¡¨
- âœ… ç‚¹å‡»è¡¨å›¾æ ‡æ—¶è°ƒç”¨ `getTableColumns` åŠ è½½åˆ—ä¿¡æ¯
- âœ… åˆ é™¤åŠŸèƒ½è°ƒç”¨ `deleteDatabase` æ¥å£

### ä¸»é¡µé¢ (`MainPage.tsx`)
- âœ… æ›´æ–° `handleDeleteDatabase` ä½¿ç”¨æ–°çš„åˆ é™¤æ¥å£

## ğŸ“ ä»£ç å˜æ›´è¯¦æƒ…

### åç«¯ (`backend/app/routes/databases.py`)
1. **åˆ é™¤æ¥å£**:
   - å¯¼å…¥ `delete_connection` æœåŠ¡å‡½æ•°
   - æ·»åŠ  `DELETE /api/v1/dbs/{name}` è·¯ç”±
   - åˆ é™¤è¿æ¥æ—¶åŒæ—¶åˆ é™¤å…³è”çš„å…ƒæ•°æ®

2. **è¡¨åˆ—è¡¨æ¥å£**:
   - å¯¼å…¥ `fetch_postgres_metadata` å‡½æ•°
   - æ·»åŠ  `GET /api/v1/dbs/{name}/tables` è·¯ç”±
   - ç›´æ¥ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œä¸ä¾èµ– LLM è½¬æ¢

3. **åˆ—ä¿¡æ¯æ¥å£**:
   - æ·»åŠ  `GET /api/v1/dbs/{name}/tables/{schema}/{table}/columns` è·¯ç”±
   - ä½¿ç”¨ `information_schema.columns` æŸ¥è¯¢åˆ—ä¿¡æ¯

### å‰ç«¯ (`frontend/src/`)
1. **API å®¢æˆ·ç«¯**:
   - æ·»åŠ ä¸‰ä¸ªæ–°æ–¹æ³•è°ƒç”¨æ–°æ¥å£

2. **æ•°æ®åº“æ ‘ç»„ä»¶**:
   - ç§»é™¤ `metadataCache` çŠ¶æ€ï¼ˆä¸å†éœ€è¦ï¼‰
   - ä½¿ç”¨ `loadDatabaseMetadata` è°ƒç”¨è¡¨åˆ—è¡¨æ¥å£
   - ä½¿ç”¨ `loadTableColumns` è°ƒç”¨åˆ—ä¿¡æ¯æ¥å£
   - ä¼˜åŒ–å±•å¼€é€»è¾‘ï¼ŒæŒ‰éœ€åŠ è½½

## ğŸ¯ åŠŸèƒ½æ”¹è¿›

1. **åˆ é™¤åŠŸèƒ½**:
   - âœ… ç°åœ¨çœŸæ­£åˆ é™¤æ•°æ®åº“è¿æ¥
   - âœ… åŒæ—¶æ¸…ç†å…³è”çš„å…ƒæ•°æ®
   - âœ… å‰ç«¯æ­£ç¡®è°ƒç”¨åç«¯æ¥å£

2. **æŒ‰éœ€åŠ è½½**:
   - âœ… ç‚¹å‡»æ•°æ®åº“å›¾æ ‡æ—¶æ‰åŠ è½½è¡¨åˆ—è¡¨
   - âœ… ç‚¹å‡»è¡¨å›¾æ ‡æ—¶æ‰åŠ è½½åˆ—ä¿¡æ¯
   - âœ… å‡å°‘ä¸å¿…è¦çš„ API è°ƒç”¨
   - âœ… æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§å‹æ•°æ®åº“

3. **æ•°æ®å®æ—¶æ€§**:
   - âœ… ç›´æ¥ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œç¡®ä¿æ•°æ®æœ€æ–°
   - âœ… ä¸ä¾èµ–ç¼“å­˜çš„å…ƒæ•°æ®

## âš ï¸ æ³¨æ„äº‹é¡¹

- åˆ é™¤æ¥å£è¿”å› 204 No Contentï¼Œå‰ç«¯éœ€è¦æ­£ç¡®å¤„ç†
- è¡¨åˆ—è¡¨å’Œåˆ—ä¿¡æ¯æ¥å£ç›´æ¥ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯èƒ½æ¯”ç¼“å­˜æ–¹å¼ç¨æ…¢
- å¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œæ¥å£ä¼šè¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯

## ğŸš€ æµ‹è¯•å»ºè®®

1. **æµ‹è¯•åˆ é™¤åŠŸèƒ½**:
   ```bash
   curl -X DELETE http://localhost:8000/api/v1/dbs/postgres
   ```

2. **æµ‹è¯•è¡¨åˆ—è¡¨æ¥å£**:
   ```bash
   curl http://localhost:8000/api/v1/dbs/postgres/tables
   ```

3. **æµ‹è¯•åˆ—ä¿¡æ¯æ¥å£**:
   ```bash
   curl http://localhost:8000/api/v1/dbs/postgres/tables/public/users/columns
   ```

